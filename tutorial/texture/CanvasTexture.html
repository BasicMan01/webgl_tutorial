<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		
		<script type="text/javascript" src="../../lib/datgui/dat.gui.min.js"></script>
		
		<script type="text/javascript" src="../../lib/threejs_85/three.min.js"></script>
		<script type="text/javascript" src="../../lib/threejs_85/controls/OrbitControls.js"></script>

		<link rel="stylesheet" type="text/css" href="../../resources/css/global.css">
	</head>

	<body>
		<div id="webGLCanvas" oncontextmenu="return false">
			<div class="tags">
				<ul>
					<li>OrbitControls</li>
					<li>AxisHelper</li>
					<li>GridHelper</li>
					<li>PlaneGeometry</li>
					<li>Canvas</li>
				</ul>
			</div>
		</div>
		
		<script type="text/javascript">
			var RDO = window.RDO || {};

			RDO.Tutorial = {
				'CAMERA_FOV': 70,
				'CAMERA_NEAR_PLANE': 0.1,
				'CAMERA_FAR_PLANE': 500
			};
			
			RDO.Tutorial.Fonts = {
				'Arial': 'Arial',
				'Arial Black': 'Arial Black',
				'Comic Sans MS': 'Comic Sans MS',
				'Courier New': 'Courier New',
				'Georgia': 'Georgia',
				'Impact': 'Impact',
				'Lucida Console': 'Lucida Console',
				'Lucida Sans Unicode': 'Lucida Sans Unicode',
				'Palatino Linotype': 'Palatino Linotype',
				'Tahoma': 'Tahoma',
				'Times New Roman': 'Times New Roman',
				'Trebuchet MS': 'Trebuchet MS',
				'Verdana': 'Verdana'
			};
			
			RDO.Tutorial.Properties = {
				'axisHelperVisible': true,
				'gridHelperVisible': true,
				'planeWidth': 5,
				'planeHeight': 5,
				'planeSegmentsX': 1,
				'planeSegmentsY': 1,
				'planeMaterialBackgroundColor': '#156289',
				'planeMaterialBackgroundOpacity': 0.3,
				'planeMaterialBorderColor': '#00ffff',
				'planeMaterialBorderOpacity': 1,
				'planeMaterialBorderLineWidth': 3,
				'planeMaterialFontColor': '#00ffff',
				'planeMaterialFontOpacity': 1,
				'planeMaterialFontSize': 11,
				'planeMaterialFontFamily': 'Courier New',
				'planePositionX': 0,
				'planePositionY': 0,
				'planePositionZ': 0,
				'planeRotationX': 0,
				'planeRotationY': 0,
				'planeRotationZ': 0,
				'planeScaleX': 1,
				'planeScaleY': 1
			};
			
			RDO.Tutorial.Main = function(canvas)
			{
				var camera;
				var controls;
				var gui = new dat.GUI({ width: 400 });
				var renderer;
				var scene;
				
				var axisHelper;
				var gridHelper;
				
				var plane;
				
				function constructor()
				{
					scene = new THREE.Scene();

					camera = new THREE.PerspectiveCamera(RDO.Tutorial.CAMERA_FOV, getCameraAspect(), RDO.Tutorial.CAMERA_NEAR_PLANE, RDO.Tutorial.CAMERA_FAR_PLANE);
					camera.position.set(0, 0, 20);
					
					renderer = new THREE.WebGLRenderer({antialias: true});
					renderer.setClearColor(0x000000, 1);
					renderer.setPixelRatio(window.devicePixelRatio);
					renderer.setSize(getGameAreaWidth(), getGameAreaHeight());
					
					controls = new THREE.OrbitControls(camera, renderer.domElement);
					
					// add renderer to the DOM-Tree
					canvas.appendChild(renderer.domElement);
					
					createGui();
					createObject();
		
					render();
					
					window.addEventListener('resize', onResizeHandler, false);
				}
				
				function createObject()
				{
					axisHelper = new THREE.AxisHelper(25);
					scene.add(axisHelper);
					
					gridHelper = new THREE.GridHelper(50, 50);
					scene.add(gridHelper);

					plane = new THREE.Mesh(
						new THREE.Geometry(),
						new THREE.SpriteMaterial()
					);
					scene.add(plane);
					
					createGeometry();
					createMaterial();
				}

				function createGeometry()
				{
					var geometry = new THREE.PlaneGeometry(
						RDO.Tutorial.Properties.planeWidth,
						RDO.Tutorial.Properties.planeHeight,
						RDO.Tutorial.Properties.planeSegmentsX,
						RDO.Tutorial.Properties.planeSegmentsY
					);
					
					plane.geometry.dispose();
					plane.geometry = geometry;
				}

				function createMaterial()
				{
					var canvas = document.createElement('canvas');
						
					canvas.height = 256;
					canvas.width = 256;
						
					var context = canvas.getContext('2d');
					
					var backgroundColor = cssColorToRgb(RDO.Tutorial.Properties.planeMaterialBackgroundColor);
					var borderColor = cssColorToRgb(RDO.Tutorial.Properties.planeMaterialBorderColor);
					var fontColor = cssColorToRgb(RDO.Tutorial.Properties.planeMaterialFontColor);

					context.fillStyle = 'rgba(' + backgroundColor.r + ', ' + backgroundColor.g + ', ' + backgroundColor.b + ', ' + RDO.Tutorial.Properties.planeMaterialBackgroundOpacity + ')';
					context.fillRect(0, 0, 256, 256);
					
					context.strokeStyle = 'rgba(' + borderColor.r + ', ' + borderColor.g + ', ' + borderColor.b + ', ' + RDO.Tutorial.Properties.planeMaterialBorderOpacity + ')';
					context.lineWidth = RDO.Tutorial.Properties.planeMaterialBorderLineWidth;
					context.strokeRect(0, 0, 256, 256);
					
					context.font = RDO.Tutorial.Properties.planeMaterialFontSize + 'px ' + RDO.Tutorial.Properties.planeMaterialFontFamily;
					context.fillStyle = 'rgba(' + fontColor.r + ', ' + fontColor.g + ', ' + fontColor.b + ', ' + RDO.Tutorial.Properties.planeMaterialFontOpacity + ')';
					
					var topPosition = 0;
					var lineHeight = RDO.Tutorial.Properties.planeMaterialFontSize + 5;

					context.fillText('Firstname: Max', 10, topPosition += lineHeight);
					context.fillText('Surname  : Mustermann', 10, topPosition += lineHeight);
					
					
					var texture = new THREE.Texture(canvas);
					
					texture.needsUpdate = true;
					
					plane.material = new THREE.MeshBasicMaterial( { map: texture, side: THREE.DoubleSide, transparent: true } );
				}
				
				function createGui()
				{
					gui.add(RDO.Tutorial.Properties, 'axisHelperVisible').onChange(function(value) {
						axisHelper.visible = value;
					});
					gui.add(RDO.Tutorial.Properties, 'gridHelperVisible').onChange(function(value) {
						gridHelper.visible = value;
					});
					
					var folderGeometry = gui.addFolder('Plane Geometry');
					folderGeometry.add(RDO.Tutorial.Properties, 'planeWidth', 0.1, 10).step(0.1).onChange(function() {
						createGeometry();
					});
					folderGeometry.add(RDO.Tutorial.Properties, 'planeHeight', 0.1, 10).step(0.1).onChange(function() {
						createGeometry();
					});
					
					var folderMaterial = gui.addFolder('Plane Material');
					folderMaterial.addColor(RDO.Tutorial.Properties, 'planeMaterialBackgroundColor').onChange(function() {
						createMaterial();
					});
					folderMaterial.add(RDO.Tutorial.Properties, 'planeMaterialBackgroundOpacity', 0, 1).step(0.1).onChange(function() {
						createMaterial();
					});
					folderMaterial.addColor(RDO.Tutorial.Properties, 'planeMaterialBorderColor').onChange(function() {
						createMaterial();
					});
					folderMaterial.add(RDO.Tutorial.Properties, 'planeMaterialBorderOpacity', 0, 1).step(0.1).onChange(function() {
						createMaterial();
					});
					folderMaterial.add(RDO.Tutorial.Properties, 'planeMaterialBorderLineWidth', 1, 10).step(1).onChange(function() {
						createMaterial();
					});
					folderMaterial.addColor(RDO.Tutorial.Properties, 'planeMaterialFontColor').onChange(function() {
						createMaterial();
					});
					folderMaterial.add(RDO.Tutorial.Properties, 'planeMaterialFontOpacity', 0, 1).step(0.1).onChange(function() {
						createMaterial();
					});
					folderMaterial.add(RDO.Tutorial.Properties, 'planeMaterialFontSize', 8, 32).step(1).onChange(function() {
						createMaterial();
					});
					folderMaterial.add(RDO.Tutorial.Properties, 'planeMaterialFontFamily', Object.keys(RDO.Tutorial.Fonts)).onChange(function() {
						createMaterial();
					});

					var folderTransformation = gui.addFolder('Plane Transformation');
					folderTransformation.add(RDO.Tutorial.Properties, 'planePositionX', -10, 10).step(0.1).onChange(function(value) {
						plane.position.x = value;
					});
					folderTransformation.add(RDO.Tutorial.Properties, 'planePositionY', -10, 10).step(0.1).onChange(function(value) {
						plane.position.y = value;
					});
					folderTransformation.add(RDO.Tutorial.Properties, 'planePositionZ', -10, 10).step(0.1).onChange(function(value) {
						plane.position.z = value;
					});
					folderTransformation.add(RDO.Tutorial.Properties, 'planeRotationX', 0, 2*Math.PI).step(0.01).onChange(function(value) {
						plane.rotation.x = value;
					});
					folderTransformation.add(RDO.Tutorial.Properties, 'planeRotationY', 0, 2*Math.PI).step(0.01).onChange(function(value) {
						plane.rotation.y = value;
					});
					folderTransformation.add(RDO.Tutorial.Properties, 'planeRotationZ', 0, 2*Math.PI).step(0.01).onChange(function(value) {
						plane.rotation.z = value;
					});
					folderTransformation.add(RDO.Tutorial.Properties, 'planeScaleX', 0.1, 10).step(0.1).onChange(function(value) {
						plane.scale.x = value;
					});
					folderTransformation.add(RDO.Tutorial.Properties, 'planeScaleY', 0.1, 10).step(0.1).onChange(function(value) {
						plane.scale.y = value;
					});
				}
				
				function render()
				{
					requestAnimationFrame(render);
					
					renderer.render(scene, camera);
				}
				
				function onResizeHandler(event)
				{
					camera.aspect = getCameraAspect();
					camera.updateProjectionMatrix();

					renderer.setSize(getGameAreaWidth(), getGameAreaHeight());
				}

				function getGameAreaHeight() { return canvas.offsetHeight; }
				function getGameAreaWidth() { return canvas.offsetWidth; }
				
				function getCameraAspect() { return getGameAreaWidth() / getGameAreaHeight(); }
				
				function cssColorToHex(cssColor) { return cssColor.replace('#', '0x'); }
				function cssColorToRgb(cssColor)
				{
					var colorInt = parseInt(cssColor.replace('#', ''), 16);
					
					return {
						r: (colorInt >> 16) & 255,
						g: (colorInt >> 8) & 255,
						b: colorInt & 255
					};
				}
				
				constructor();
			};
			
			document.addEventListener('DOMContentLoaded', function()
			{
				var tutorial = new RDO.Tutorial.Main(document.getElementById('webGLCanvas'));
			});
		</script>
	</body>
</html>